

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Nonlinear Valuation &#8212; Dynamic Programming</title>
    <script src="https://unpkg.com/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.1/dist/tippy-bundle.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
        <script>
            MathJax = {
            loader: {load: ['[tex]/boldsymbol', '[tex]/textmacros']},
            tex: {
                packages: {'[+]': ['boldsymbol', 'textmacros']},
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                processEscapes: true,
                macros: {
                    "argmax" : "arg\\,max",
                    "argmin" : "arg\\,min",
                    "col"    : "col",
                    "Span"   :  "span",
                    "epsilon": "\\varepsilon",
                    "EE": "\\mathbb{E}",
                    "PP": "\\mathbb{P}",
                    "RR": "\\mathbb{R}",
                    "NN": "\\mathbb{N}",
                    "ZZ": "\\mathbb{Z}",
                    "aA": "\\mathcal{A}",
                    "bB": "\\mathcal{B}",
                    "cC": "\\mathcal{C}",
                    "dD": "\\mathcal{D}",
                    "eE": "\\mathcal{E}",
                    "fF": "\\mathcal{F}",
                    "gG": "\\mathcal{G}",
                    "hH": "\\mathcal{H}",
                }
            },
            svg: {
                fontCache: 'global',
                scale: 0.92,
                displayAlign: "center",
            },
            };
        </script>
    
    
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/quantecon-book-theme.b1c2e4f636e57c481a96e252d9ca7e4e.css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />


    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script src="_static/quantecon-book-theme.ef2ef6c3e8da75e1e736fb5fce08cde6.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'nonlinear_valuation';</script>
    <link rel="shortcut icon" href="_static/lectures-favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Recursive Decision Processes" href="recursive_decision_processes.html" />
    <link rel="prev" title="Stochastic Discounting" href="stochastic_discounting.html" />

<!-- Normal Meta Tags -->
<meta name="author" context="Thomas J. Sargent &amp; John Stachurski" />
<meta name="keywords" content="" />
<meta name="description" content=Nonlinear Valuation  Contents  Nonlinear Valuation  rs_utility.jl  ez_utility.jl  rs_utility.jl  include(&#34;s_approx.jl&#34;) using LinearAlgebra, QuantEcon  function />

<!-- Twitter tags -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@quantecon" />
<meta name="twitter:title" content="Nonlinear Valuation"/>
<meta name="twitter:description" content="Nonlinear Valuation  Contents  Nonlinear Valuation  rs_utility.jl  ez_utility.jl  rs_utility.jl  include(&#34;s_approx.jl&#34;) using LinearAlgebra, QuantEcon  function">
<meta name="twitter:creator" content="@quantecon">
<meta name="twitter:image" content="https://assets.quantecon.org/img/qe-twitter-logo.png">

<!-- Opengraph tags -->
<meta property="og:title" content="Nonlinear Valuation" />
<meta property="og:type" content="website" />
<meta property="og:url" content="None" />
<meta property="og:image" content="https://assets.quantecon.org/img/qe-og-logo.png" />
<meta property="og:description" content="Nonlinear Valuation  Contents  Nonlinear Valuation  rs_utility.jl  ez_utility.jl  rs_utility.jl  include(&#34;s_approx.jl&#34;) using LinearAlgebra, QuantEcon  function" />
<meta property="og:site_name" content="Dynamic Programming" />
<meta name="theme-color" content="#ffffff" />

  </head>
<body>


    <span id="top"></span>

    <div class="qe-wrapper">

        <div class="qe-main">

            <div class="qe-page" id=nonlinear_valuation>

                <div class="qe-page__toc">

                    <div class="inner">

                        
                        <div class="qe-page__toc-header">
                            On this page
                        </div>


                        <nav id="bd-toc-nav" class="qe-page__toc-nav">
                            <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rs-utility-jl">rs_utility.jl</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ez-utility-jl">ez_utility.jl</a></li>
</ul>
                            <p class="logo">
                                
                                    
                                    <a href=https://quantecon.org><img src="_static/qe-logo.png" class="logo" alt="logo"></a>
                                    
                                
                            </p>

                            <p class="powered">Powered by <a href="https://jupyterbook.org/">Jupyter Book</a></p>

                        </nav>

                        <div class="qe-page__toc-footer">
                            
                            
                            <p><a href="#top"><strong>Back to top</strong></a></p>
                        </div>

                    </div>

                </div>

                <div class="qe-page__header">

                    <div class="qe-page__header-copy">

                        <p class="qe-page__header-heading"><a href="intro.html">Dynamic Programming</a></p>

                        <p class="qe-page__header-subheading">Nonlinear Valuation</p>

                    </div>

                    <p class="qe-page__header-authors">Thomas J. Sargent & John Stachurski</p>

                </div> <!-- .page__header -->



                
                <main class="qe-page__content" role="main">
                    
                    <div>
                        
  <div id="qe-notebook-header" style="text-align:right;">
        <a href="https://quantecon.org/" title="quantecon.org">
                <img style="width:250px;display:inline;" src="https://assets.quantecon.org/img/qe-menubar-logo.svg" alt="QuantEcon">
        </a>
</div><section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1><a class="toc-backref" href="#id2">Nonlinear Valuation</a><a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#id1" id="id2">Nonlinear Valuation</a></p>
<ul>
<li><p><a class="reference internal" href="#rs-utility-jl" id="id3">rs_utility.jl</a></p></li>
<li><p><a class="reference internal" href="#ez-utility-jl" id="id4">ez_utility.jl</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="rs-utility-jl">
<h2><a class="toc-backref" href="#id3">rs_utility.jl</a><a class="headerlink" href="#rs-utility-jl" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">include</span><span class="p">(</span><span class="s">&quot;s_approx.jl&quot;</span><span class="p">)</span>
<span class="k">using</span><span class="w"> </span><span class="n">LinearAlgebra</span><span class="p">,</span><span class="w"> </span><span class="n">QuantEcon</span>

<span class="k">function</span><span class="w"> </span><span class="n">create_rs_utility_model</span><span class="p">(;</span>
<span class="w">        </span><span class="n">n</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span><span class="w">      </span><span class="c"># size of state space</span>
<span class="w">        </span><span class="n">β</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span><span class="w">     </span><span class="c"># time discount factor</span>
<span class="w">        </span><span class="n">ρ</span><span class="o">=</span><span class="mf">0.96</span><span class="p">,</span><span class="w">     </span><span class="c"># correlation coef in AR(1)</span>
<span class="w">        </span><span class="n">σ</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="w">      </span><span class="c"># volatility</span>
<span class="w">        </span><span class="n">θ</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">)</span><span class="w">     </span><span class="c"># risk aversion</span>
<span class="w">    </span><span class="n">mc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tauchen</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ρ</span><span class="p">,</span><span class="w"> </span><span class="n">σ</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w">  </span><span class="c"># n_std = 10</span>
<span class="w">    </span><span class="n">x_vals</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mc</span><span class="o">.</span><span class="n">state_values</span><span class="p">,</span><span class="w"> </span><span class="n">mc</span><span class="o">.</span><span class="n">p</span><span class="w"> </span>
<span class="w">    </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x_vals</span><span class="w">      </span><span class="c"># special case u(c(x)) = x</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="n">β</span><span class="p">,</span><span class="w"> </span><span class="n">θ</span><span class="p">,</span><span class="w"> </span><span class="n">ρ</span><span class="p">,</span><span class="w"> </span><span class="n">σ</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">x_vals</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">K</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">)</span>
<span class="w">    </span><span class="p">(;</span><span class="w"> </span><span class="n">β</span><span class="p">,</span><span class="w"> </span><span class="n">θ</span><span class="p">,</span><span class="w"> </span><span class="n">ρ</span><span class="p">,</span><span class="w"> </span><span class="n">σ</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">x_vals</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">β</span><span class="o">/</span><span class="n">θ</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">log</span><span class="o">.</span><span class="p">(</span><span class="n">P</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="p">(</span><span class="n">θ</span><span class="o">*</span><span class="n">v</span><span class="p">)))</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">compute_rs_utility</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="w">    </span><span class="p">(;</span><span class="w"> </span><span class="n">β</span><span class="p">,</span><span class="w"> </span><span class="n">θ</span><span class="p">,</span><span class="w"> </span><span class="n">ρ</span><span class="p">,</span><span class="w"> </span><span class="n">σ</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">x_vals</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span>
<span class="w">    </span><span class="n">v_init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">x_vals</span><span class="p">))</span>
<span class="w">    </span><span class="n">v_star</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">successive_approx</span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">K</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">),</span><span class="w"> </span>
<span class="w">                               </span><span class="n">v_init</span><span class="p">,</span><span class="w"> </span><span class="n">tolerance</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v_star</span>
<span class="k">end</span>


<span class="c"># Plots</span>

<span class="k">using</span><span class="w"> </span><span class="n">PyPlot</span>
<span class="k">using</span><span class="w"> </span><span class="n">LaTeXStrings</span>
<span class="n">PyPlot</span><span class="o">.</span><span class="n">matplotlib</span><span class="p">[</span><span class="ss">:rc</span><span class="p">](</span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">usetex</span><span class="o">=</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="c"># allow tex rendering</span>
<span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span>

<span class="k">function</span><span class="w"> </span><span class="n">plot_v</span><span class="p">(;</span><span class="w"> </span><span class="n">savefig</span><span class="o">=</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span>
<span class="w">                  </span><span class="n">figname</span><span class="o">=</span><span class="s">&quot;../figures/rs_utility_1.pdf&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">fig</span><span class="p">,</span><span class="w"> </span><span class="n">ax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mf">5.2</span><span class="p">))</span>
<span class="w">    </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_rs_utility_model</span><span class="p">()</span>
<span class="w">    </span><span class="p">(;</span><span class="w"> </span><span class="n">β</span><span class="p">,</span><span class="w"> </span><span class="n">θ</span><span class="p">,</span><span class="w"> </span><span class="n">ρ</span><span class="p">,</span><span class="w"> </span><span class="n">σ</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">x_vals</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span>

<span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">ρ</span><span class="o">*</span><span class="n">β</span><span class="p">))</span>
<span class="w">    </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">β</span><span class="w"> </span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">β</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">θ</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">σ</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="w"> </span>
<span class="w">    </span>
<span class="w">    </span><span class="n">v_star</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compute_rs_utility</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="w">    </span><span class="n">v_star_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x_vals</span><span class="w"> </span><span class="o">.+</span><span class="w"> </span><span class="n">b</span>
<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="w"> </span><span class="n">v_star</span><span class="p">,</span><span class="w"> </span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s">&quot;approximate fixed point&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="w"> </span><span class="n">v_star_a</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;k--&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="sa">L</span><span class="s">&quot;v(x)=ax + b&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">L</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="w"> </span><span class="n">loc</span><span class="o">=</span><span class="s">&quot;upper left&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">savefig</span>
<span class="w">        </span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>
<span class="k">end</span>




<span class="k">function</span><span class="w"> </span><span class="n">plot_multiple_v</span><span class="p">(;</span><span class="w"> </span><span class="n">savefig</span><span class="o">=</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span>
<span class="w">                  </span><span class="n">figname</span><span class="o">=</span><span class="s">&quot;../figures/rs_utility_2.pdf&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">fig</span><span class="p">,</span><span class="w"> </span><span class="n">ax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mf">5.2</span><span class="p">))</span>
<span class="w">    </span><span class="n">σ_vals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.05</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">σ</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">σ_vals</span>
<span class="w">        </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_rs_utility_model</span><span class="p">(</span><span class="n">σ</span><span class="o">=</span><span class="n">σ</span><span class="p">)</span>
<span class="w">        </span><span class="p">(;</span><span class="w"> </span><span class="n">β</span><span class="p">,</span><span class="w"> </span><span class="n">θ</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">x_vals</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span>
<span class="w">        </span><span class="n">v_star</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compute_rs_utility</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="w"> </span><span class="n">v_star</span><span class="p">,</span><span class="w"> </span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="sa">L</span><span class="s">&quot;\sigma=&quot;</span><span class="o">*</span><span class="s">&quot;</span><span class="si">$σ</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">L</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">L</span><span class="s">&quot;v(x)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>

<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="w"> </span><span class="n">loc</span><span class="o">=</span><span class="s">&quot;upper left&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">savefig</span>
<span class="w">        </span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>plot_multiple_v (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">plot_v</span><span class="p">(</span><span class="n">savefig</span><span class="o">=</span><span class="nb">true</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 25 with error 0.6551733102188564.
Completed iteration 50 with error 0.16567516808198945.
Completed iteration 75 with error 0.044889308777882775.
Completed iteration 100 with error 0.012367970868957912.
Completed iteration 125 with error 0.0034238793852026106.
Completed iteration 150 with error 0.0009491803696306533.
Completed iteration 175 with error 0.00026324562215052083.
Completed iteration 200 with error 7.301768051348745e-5.
Completed iteration 225 with error 2.025401865068943e-5.
Completed iteration 250 with error 5.6182266447990514e-6.
Completed iteration 275 with error 1.5584352581754501e-6.
Completed iteration 300 with error 4.322935041045639e-7.
Completed iteration 325 with error 1.1991370030273174e-7.
Completed iteration 350 with error 3.326281472482151e-8.
Completed iteration 375 with error 9.226766906067496e-9.
Completed iteration 400 with error 2.559410461344669e-9.
Completed iteration 425 with error 7.099600907167769e-10.
Completed iteration 450 with error 1.9694113007062697e-10.
Terminated successfully in 465 iterations.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="_images/64c685e26c087351e620d0fd9369b949adc84ae020076520fc5803dd5b358e8e.png" src="_images/64c685e26c087351e620d0fd9369b949adc84ae020076520fc5803dd5b358e8e.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">plot_multiple_v</span><span class="p">(</span><span class="n">savefig</span><span class="o">=</span><span class="nb">true</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 25 with error 0.2636239967879277.
Completed iteration 50 with error 0.05190477488617873.
Completed iteration 75 with error 0.01235054779784761.
Completed iteration 100 with error 0.003222014685647423.
Completed iteration 125 with error 0.0008733772549120999.
Completed iteration 150 with error 0.00024022882517016342.
Completed iteration 175 with error 6.643334072009566e-5.
Completed iteration 200 with error 1.840755902904334e-5.
Completed iteration 225 with error 5.104029845881541e-6.
Completed iteration 250 with error 1.4156012113630823e-6.
Completed iteration 275 with error 3.926526765951621e-7.
Completed iteration 300 with error 1.0891572443938458e-7.
Completed iteration 325 with error 3.021188277330111e-8.
Completed iteration 350 with error 8.38044300621732e-9.
Completed iteration 375 with error 2.3246471414495318e-9.
Completed iteration 400 with error 6.448388489843637e-10.
Completed iteration 425 with error 1.7887202830024762e-10.
Terminated successfully in 438 iterations.
Completed iteration 25 with error 0.6551733102188564.
Completed iteration 50 with error 0.16567516808198945.
Completed iteration 75 with error 0.044889308777882775.
Completed iteration 100 with error 0.012367970868957912.
Completed iteration 125 with error 0.0034238793852026106.
Completed iteration 150 with error 0.0009491803696306533.
Completed iteration 175 with error 0.00026324562215052083.
Completed iteration 200 with error 7.301768051348745e-5.
Completed iteration 225 with error 2.025401865068943e-5.
Completed iteration 250 with error 5.6182266447990514e-6.
Completed iteration 275 with error 1.5584352581754501e-6.
Completed iteration 300 with error 4.322935041045639e-7.
Completed iteration 325 with error 1.1991370030273174e-7.
Completed iteration 350 with error 3.326281472482151e-8.
Completed iteration 375 with error 9.226766906067496e-9.
Completed iteration 400 with error 2.559410461344669e-9.
Completed iteration 425 with error 7.099600907167769e-10.
Completed iteration 450 with error 1.9694113007062697e-10.
Terminated successfully in 465 iterations.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="_images/1795d4f6e486a0f2e6386de15b6b65c0ec5f8fe15020164fcae8f06c6254ac68.png" src="_images/1795d4f6e486a0f2e6386de15b6b65c0ec5f8fe15020164fcae8f06c6254ac68.png" />
</div>
</div>
</section>
<section id="ez-utility-jl">
<h2><a class="toc-backref" href="#id4">ez_utility.jl</a><a class="headerlink" href="#ez-utility-jl" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;&quot;&quot;</span>
<span class="s">Epstein--Zin utility: solving the recursion for a given consumption</span>
<span class="s">path.</span>

<span class="s">&quot;&quot;&quot;</span>

<span class="n">include</span><span class="p">(</span><span class="s">&quot;s_approx.jl&quot;</span><span class="p">)</span>
<span class="k">using</span><span class="w"> </span><span class="n">LinearAlgebra</span><span class="p">,</span><span class="w"> </span><span class="n">QuantEcon</span>

<span class="k">function</span><span class="w"> </span><span class="n">create_ez_utility_model</span><span class="p">(;</span>
<span class="w">        </span><span class="n">n</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="w">      </span><span class="c"># size of state space</span>
<span class="w">        </span><span class="n">ρ</span><span class="o">=</span><span class="mf">0.96</span><span class="p">,</span><span class="w">     </span><span class="c"># correlation coef in AR(1)</span>
<span class="w">        </span><span class="n">σ</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="w">      </span><span class="c"># volatility</span>
<span class="w">        </span><span class="n">β</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span><span class="w">     </span><span class="c"># time discount factor</span>
<span class="w">        </span><span class="n">α</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span><span class="w">     </span><span class="c"># EIS parameter</span>
<span class="w">        </span><span class="n">γ</span><span class="o">=-</span><span class="mf">2.0</span><span class="p">)</span><span class="w">     </span><span class="c"># risk aversion parameter</span>

<span class="w">    </span><span class="n">mc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tauchen</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ρ</span><span class="p">,</span><span class="w"> </span><span class="n">σ</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="n">x_vals</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mc</span><span class="o">.</span><span class="n">state_values</span><span class="p">,</span><span class="w"> </span><span class="n">mc</span><span class="o">.</span><span class="n">p</span><span class="w"> </span>
<span class="w">    </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">exp</span><span class="o">.</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span><span class="w">      </span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="n">β</span><span class="p">,</span><span class="w"> </span><span class="n">ρ</span><span class="p">,</span><span class="w"> </span><span class="n">σ</span><span class="p">,</span><span class="w"> </span><span class="n">α</span><span class="p">,</span><span class="w"> </span><span class="n">γ</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">x_vals</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">K</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">)</span>
<span class="w">    </span><span class="p">(;</span><span class="w"> </span><span class="n">β</span><span class="p">,</span><span class="w"> </span><span class="n">ρ</span><span class="p">,</span><span class="w"> </span><span class="n">σ</span><span class="p">,</span><span class="w"> </span><span class="n">α</span><span class="p">,</span><span class="w"> </span><span class="n">γ</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">x_vals</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span>

<span class="w">    </span><span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">P</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="o">.^</span><span class="n">γ</span><span class="p">))</span><span class="o">.^</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">γ</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">β</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">c</span><span class="o">.^</span><span class="n">α</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">β</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">R</span><span class="o">.^</span><span class="n">α</span><span class="p">)</span><span class="o">.^</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">α</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">compute_ez_utility</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="w">    </span><span class="n">v_init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ones</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">x_vals</span><span class="p">))</span>
<span class="w">    </span><span class="n">v_star</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">successive_approx</span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">K</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">),</span><span class="w"> </span>
<span class="w">                               </span><span class="n">v_init</span><span class="p">,</span><span class="w"> </span>
<span class="w">                               </span><span class="n">tolerance</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v_star</span>
<span class="k">end</span>


<span class="c"># Plots</span>

<span class="k">using</span><span class="w"> </span><span class="n">PyPlot</span>
<span class="k">using</span><span class="w"> </span><span class="n">LaTeXStrings</span>
<span class="n">PyPlot</span><span class="o">.</span><span class="n">matplotlib</span><span class="p">[</span><span class="ss">:rc</span><span class="p">](</span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">usetex</span><span class="o">=</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="c"># allow tex rendering</span>
<span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span>

<span class="k">function</span><span class="w"> </span><span class="n">plot_convergence</span><span class="p">(;</span><span class="w"> </span><span class="n">savefig</span><span class="o">=</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span>
<span class="w">                  </span><span class="n">num_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<span class="w">                  </span><span class="n">figname</span><span class="o">=</span><span class="s">&quot;../figures/ez_utility_c.pdf&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">fig</span><span class="p">,</span><span class="w"> </span><span class="n">ax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mf">5.2</span><span class="p">))</span>
<span class="w">    </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_ez_utility_model</span><span class="p">()</span>
<span class="w">    </span><span class="p">(;</span><span class="w"> </span><span class="n">β</span><span class="p">,</span><span class="w"> </span><span class="n">ρ</span><span class="p">,</span><span class="w"> </span><span class="n">σ</span><span class="p">,</span><span class="w"> </span><span class="n">α</span><span class="p">,</span><span class="w"> </span><span class="n">γ</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">x_vals</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span>


<span class="w">    </span><span class="n">v_star</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compute_ez_utility</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="w">    </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_star</span>
<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;k-&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="sa">L</span><span class="s">&quot;v_0&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">greys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">string</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">LinRange</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4</span><span class="p">,</span><span class="w"> </span><span class="n">num_iter</span><span class="p">)]</span>
<span class="w">    </span><span class="n">greys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reverse</span><span class="p">(</span><span class="n">greys</span><span class="p">)</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">enumerate</span><span class="p">(</span><span class="n">greys</span><span class="p">)</span>
<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;k-&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">20</span>
<span class="w">            </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">K</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">)</span>
<span class="w">        </span><span class="k">end</span>
<span class="w">    </span><span class="k">end</span>

<span class="w">    </span><span class="n">v_star</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compute_ez_utility</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="w"> </span><span class="n">v_star</span><span class="p">,</span><span class="w"> </span><span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="sa">L</span><span class="s">&quot;v^*&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">L</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="w"> </span><span class="n">loc</span><span class="o">=</span><span class="s">&quot;upper left&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">savefig</span>
<span class="w">        </span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>
<span class="k">end</span>


<span class="k">function</span><span class="w"> </span><span class="n">plot_v</span><span class="p">(;</span><span class="w"> </span><span class="n">savefig</span><span class="o">=</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span>
<span class="w">                  </span><span class="n">figname</span><span class="o">=</span><span class="s">&quot;../figures/ez_utility_1.pdf&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">fig</span><span class="p">,</span><span class="w"> </span><span class="n">ax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mf">5.2</span><span class="p">))</span>
<span class="w">    </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_ez_utility_model</span><span class="p">()</span>
<span class="w">    </span><span class="p">(;</span><span class="w"> </span><span class="n">β</span><span class="p">,</span><span class="w"> </span><span class="n">ρ</span><span class="p">,</span><span class="w"> </span><span class="n">σ</span><span class="p">,</span><span class="w"> </span><span class="n">α</span><span class="p">,</span><span class="w"> </span><span class="n">γ</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">x_vals</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span>
<span class="w">    </span><span class="n">v_star</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compute_ez_utility</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="w"> </span><span class="n">v_star</span><span class="p">,</span><span class="w"> </span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="sa">L</span><span class="s">&quot;v^*&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">L</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="w"> </span><span class="n">loc</span><span class="o">=</span><span class="s">&quot;upper left&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">savefig</span>
<span class="w">        </span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>
<span class="k">end</span>


<span class="k">function</span><span class="w"> </span><span class="n">vary_gamma</span><span class="p">(;</span><span class="w"> </span><span class="n">gamma_vals</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">8.0</span><span class="p">],</span>
<span class="w">                  </span><span class="n">savefig</span><span class="o">=</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span>
<span class="w">                  </span><span class="n">figname</span><span class="o">=</span><span class="s">&quot;../figures/ez_utility_2.pdf&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">fig</span><span class="p">,</span><span class="w"> </span><span class="n">ax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mf">5.2</span><span class="p">))</span>
<span class="w">    </span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">γ</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">gamma_vals</span>
<span class="w">        </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_ez_utility_model</span><span class="p">(</span><span class="n">γ</span><span class="o">=</span><span class="n">γ</span><span class="p">)</span>
<span class="w">        </span><span class="p">(;</span><span class="w"> </span><span class="n">β</span><span class="p">,</span><span class="w"> </span><span class="n">ρ</span><span class="p">,</span><span class="w"> </span><span class="n">σ</span><span class="p">,</span><span class="w"> </span><span class="n">α</span><span class="p">,</span><span class="w"> </span><span class="n">γ</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">x_vals</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span>
<span class="w">        </span><span class="n">v_star</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compute_ez_utility</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="w"> </span><span class="n">v_star</span><span class="p">,</span><span class="w"> </span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="sa">L</span><span class="s">&quot;\gamma=&quot;</span><span class="o">*</span><span class="s">&quot;</span><span class="si">$γ</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">L</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">L</span><span class="s">&quot;v(x)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>

<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="w"> </span><span class="n">loc</span><span class="o">=</span><span class="s">&quot;upper left&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">savefig</span>
<span class="w">        </span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>
<span class="k">end</span>


<span class="k">function</span><span class="w"> </span><span class="n">vary_alpha</span><span class="p">(;</span><span class="w"> </span><span class="n">alpha_vals</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6</span><span class="p">],</span>
<span class="w">                  </span><span class="n">savefig</span><span class="o">=</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span>
<span class="w">                  </span><span class="n">figname</span><span class="o">=</span><span class="s">&quot;../figures/ez_utility_3.pdf&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">fig</span><span class="p">,</span><span class="w"> </span><span class="n">ax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mf">5.2</span><span class="p">))</span>
<span class="w">    </span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">α</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">alpha_vals</span>
<span class="w">        </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_ez_utility_model</span><span class="p">(</span><span class="n">α</span><span class="o">=</span><span class="n">α</span><span class="p">)</span>
<span class="w">        </span><span class="p">(;</span><span class="w"> </span><span class="n">β</span><span class="p">,</span><span class="w"> </span><span class="n">ρ</span><span class="p">,</span><span class="w"> </span><span class="n">σ</span><span class="p">,</span><span class="w"> </span><span class="n">α</span><span class="p">,</span><span class="w"> </span><span class="n">γ</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">x_vals</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span>
<span class="w">        </span><span class="n">v_star</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compute_ez_utility</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="w"> </span><span class="n">v_star</span><span class="p">,</span><span class="w"> </span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="sa">L</span><span class="s">&quot;</span><span class="se">\a</span><span class="s">lpha=&quot;</span><span class="o">*</span><span class="s">&quot;</span><span class="si">$α</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">L</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">L</span><span class="s">&quot;v(x)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>

<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="w"> </span><span class="n">loc</span><span class="o">=</span><span class="s">&quot;upper left&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">savefig</span>
<span class="w">        </span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>vary_alpha (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">plot_convergence</span><span class="p">(</span><span class="n">savefig</span><span class="o">=</span><span class="nb">true</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 25 with error 0.007206209255429918.
Completed iteration 50 with error 0.00156719788591686.
Completed iteration 75 with error 0.0004273965382449729.
Completed iteration 100 with error 0.00017898582383268913.
Completed iteration 125 with error 9.707282676585383e-5.
Completed iteration 150 with error 6.428406156244737e-5.
Completed iteration 175 with error 5.310395754842823e-5.
Completed iteration 200 with error 4.2962945759894566e-5.
Completed iteration 225 with error 3.408528264214894e-5.
Completed iteration 250 with error 2.686432249121573e-5.
Completed iteration 275 with error 2.1125470141880598e-5.
Completed iteration 300 with error 1.659984383839408e-5.
Completed iteration 325 with error 1.304040010574603e-5.
Completed iteration 350 with error 1.02433780719835e-5.
Completed iteration 375 with error 8.046119378546379e-6.
Completed iteration 400 with error 6.3201732083406625e-6.
Completed iteration 425 with error 4.964472275492682e-6.
Completed iteration 450 with error 3.899592444955857e-6.
Completed iteration 475 with error 3.063142525849827e-6.
Completed iteration 500 with error 2.4061169781042224e-6.
Completed iteration 525 with error 1.8900248721642754e-6.
Completed iteration 550 with error 1.4846336269247473e-6.
Completed iteration 575 with error 1.1661968122300692e-6.
Completed iteration 600 with error 9.16062327993572e-7.
Completed iteration 625 with error 7.195793338965473e-7.
Completed iteration 650 with error 5.652397836453105e-7.
Completed iteration 675 with error 4.4400418097723104e-7.
Completed iteration 700 with error 3.487720177108855e-7.
Completed iteration 725 with error 2.7396582580330175e-7.
Completed iteration 750 with error 2.152044744629933e-7.
Completed iteration 775 with error 1.690465507575567e-7.
Completed iteration 800 with error 1.3278879240630204e-7.
Completed iteration 825 with error 1.0430775509995271e-7.
Completed iteration 850 with error 8.193544798196228e-8.
Completed iteration 875 with error 6.436164068368555e-8.
Completed iteration 900 with error 5.055713092616543e-8.
Completed iteration 925 with error 3.9713462740564864e-8.
Completed iteration 950 with error 3.119558344977236e-8.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 975 with error 2.4504649198675565e-8.
Completed iteration 1000 with error 1.9248809657312904e-8.
Completed iteration 1025 with error 1.5120260599132962e-8.
Completed iteration 1050 with error 1.1877216765654453e-8.
Completed iteration 1075 with error 9.32975185996554e-9.
Completed iteration 1100 with error 7.328675666329332e-9.
Completed iteration 1125 with error 5.756797483158493e-9.
Completed iteration 1150 with error 4.522060725875576e-9.
Completed iteration 1175 with error 3.552153904351485e-9.
Completed iteration 1200 with error 2.790276454334162e-9.
Completed iteration 1225 with error 2.1918089565531318e-9.
Completed iteration 1250 with error 1.7217023362547934e-9.
Completed iteration 1275 with error 1.3524257269637019e-9.
Completed iteration 1300 with error 1.0623533164277887e-9.
Completed iteration 1325 with error 8.344962498796349e-10.
Completed iteration 1350 with error 6.555103126970607e-10.
Completed iteration 1375 with error 5.149147774829999e-10.
Completed iteration 1400 with error 4.044742318853878e-10.
Completed iteration 1425 with error 3.177209606519682e-10.
Completed iteration 1450 with error 2.495754714004761e-10.
Completed iteration 1475 with error 1.9604562417896432e-10.
Completed iteration 1500 with error 1.5399703734431114e-10.
Completed iteration 1525 with error 1.2096723622789796e-10.
Terminated successfully in 1546 iterations.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 25 with error 0.007206209255429918.
Completed iteration 50 with error 0.00156719788591686.
Completed iteration 75 with error 0.0004273965382449729.
Completed iteration 100 with error 0.00017898582383268913.
Completed iteration 125 with error 9.707282676585383e-5.
Completed iteration 150 with error 6.428406156244737e-5.
Completed iteration 175 with error 5.310395754842823e-5.
Completed iteration 200 with error 4.2962945759894566e-5.
Completed iteration 225 with error 3.408528264214894e-5.
Completed iteration 250 with error 2.686432249121573e-5.
Completed iteration 275 with error 2.1125470141880598e-5.
Completed iteration 300 with error 1.659984383839408e-5.
Completed iteration 325 with error 1.304040010574603e-5.
Completed iteration 350 with error 1.02433780719835e-5.
Completed iteration 375 with error 8.046119378546379e-6.
Completed iteration 400 with error 6.3201732083406625e-6.
Completed iteration 425 with error 4.964472275492682e-6.
Completed iteration 450 with error 3.899592444955857e-6.
Completed iteration 475 with error 3.063142525849827e-6.
Completed iteration 500 with error 2.4061169781042224e-6.
Completed iteration 525 with error 1.8900248721642754e-6.
Completed iteration 550 with error 1.4846336269247473e-6.
Completed iteration 575 with error 1.1661968122300692e-6.
Completed iteration 600 with error 9.16062327993572e-7.
Completed iteration 625 with error 7.195793338965473e-7.
Completed iteration 650 with error 5.652397836453105e-7.
Completed iteration 675 with error 4.4400418097723104e-7.
Completed iteration 700 with error 3.487720177108855e-7.
Completed iteration 725 with error 2.7396582580330175e-7.
Completed iteration 750 with error 2.152044744629933e-7.
Completed iteration 775 with error 1.690465507575567e-7.
Completed iteration 800 with error 1.3278879240630204e-7.
Completed iteration 825 with error 1.0430775509995271e-7.
Completed iteration 850 with error 8.193544798196228e-8.
Completed iteration 875 with error 6.436164068368555e-8.
Completed iteration 900 with error 5.055713092616543e-8.
Completed iteration 925 with error 3.9713462740564864e-8.
Completed iteration 950 with error 3.119558344977236e-8.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>sys:1: UserWarning: color is redundantly defined by the &#39;color&#39; keyword argument and the fmt string &quot;k-&quot; (-&gt; color=&#39;k&#39;). The keyword argument will take precedence.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 975 with error 2.4504649198675565e-8.
Completed iteration 1000 with error 1.9248809657312904e-8.
Completed iteration 1025 with error 1.5120260599132962e-8.
Completed iteration 1050 with error 1.1877216765654453e-8.
Completed iteration 1075 with error 9.32975185996554e-9.
Completed iteration 1100 with error 7.328675666329332e-9.
Completed iteration 1125 with error 5.756797483158493e-9.
Completed iteration 1150 with error 4.522060725875576e-9.
Completed iteration 1175 with error 3.552153904351485e-9.
Completed iteration 1200 with error 2.790276454334162e-9.
Completed iteration 1225 with error 2.1918089565531318e-9.
Completed iteration 1250 with error 1.7217023362547934e-9.
Completed iteration 1275 with error 1.3524257269637019e-9.
Completed iteration 1300 with error 1.0623533164277887e-9.
Completed iteration 1325 with error 8.344962498796349e-10.
Completed iteration 1350 with error 6.555103126970607e-10.
Completed iteration 1375 with error 5.149147774829999e-10.
Completed iteration 1400 with error 4.044742318853878e-10.
Completed iteration 1425 with error 3.177209606519682e-10.
Completed iteration 1450 with error 2.495754714004761e-10.
Completed iteration 1475 with error 1.9604562417896432e-10.
Completed iteration 1500 with error 1.5399703734431114e-10.
Completed iteration 1525 with error 1.2096723622789796e-10.
Terminated successfully in 1546 iterations.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="_images/bf01907ef6b93d0a5323b89f75cc4969c146b6218439df774802dd0e04cf5144.png" src="_images/bf01907ef6b93d0a5323b89f75cc4969c146b6218439df774802dd0e04cf5144.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">plot_v</span><span class="p">(</span><span class="n">savefig</span><span class="o">=</span><span class="nb">true</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 25 with error 0.007206209255429918.
Completed iteration 50 with error 0.00156719788591686.
Completed iteration 75 with error 0.0004273965382449729.
Completed iteration 100 with error 0.00017898582383268913.
Completed iteration 125 with error 9.707282676585383e-5.
Completed iteration 150 with error 6.428406156244737e-5.
Completed iteration 175 with error 5.310395754842823e-5.
Completed iteration 200 with error 4.2962945759894566e-5.
Completed iteration 225 with error 3.408528264214894e-5.
Completed iteration 250 with error 2.686432249121573e-5.
Completed iteration 275 with error 2.1125470141880598e-5.
Completed iteration 300 with error 1.659984383839408e-5.
Completed iteration 325 with error 1.304040010574603e-5.
Completed iteration 350 with error 1.02433780719835e-5.
Completed iteration 375 with error 8.046119378546379e-6.
Completed iteration 400 with error 6.3201732083406625e-6.
Completed iteration 425 with error 4.964472275492682e-6.
Completed iteration 450 with error 3.899592444955857e-6.
Completed iteration 475 with error 3.063142525849827e-6.
Completed iteration 500 with error 2.4061169781042224e-6.
Completed iteration 525 with error 1.8900248721642754e-6.
Completed iteration 550 with error 1.4846336269247473e-6.
Completed iteration 575 with error 1.1661968122300692e-6.
Completed iteration 600 with error 9.16062327993572e-7.
Completed iteration 625 with error 7.195793338965473e-7.
Completed iteration 650 with error 5.652397836453105e-7.
Completed iteration 675 with error 4.4400418097723104e-7.
Completed iteration 700 with error 3.487720177108855e-7.
Completed iteration 725 with error 2.7396582580330175e-7.
Completed iteration 750 with error 2.152044744629933e-7.
Completed iteration 775 with error 1.690465507575567e-7.
Completed iteration 800 with error 1.3278879240630204e-7.
Completed iteration 825 with error 1.0430775509995271e-7.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 850 with error 8.193544798196228e-8.
Completed iteration 875 with error 6.436164068368555e-8.
Completed iteration 900 with error 5.055713092616543e-8.
Completed iteration 925 with error 3.9713462740564864e-8.
Completed iteration 950 with error 3.119558344977236e-8.
Completed iteration 975 with error 2.4504649198675565e-8.
Completed iteration 1000 with error 1.9248809657312904e-8.
Completed iteration 1025 with error 1.5120260599132962e-8.
Completed iteration 1050 with error 1.1877216765654453e-8.
Completed iteration 1075 with error 9.32975185996554e-9.
Completed iteration 1100 with error 7.328675666329332e-9.
Completed iteration 1125 with error 5.756797483158493e-9.
Completed iteration 1150 with error 4.522060725875576e-9.
Completed iteration 1175 with error 3.552153904351485e-9.
Completed iteration 1200 with error 2.790276454334162e-9.
Completed iteration 1225 with error 2.1918089565531318e-9.
Completed iteration 1250 with error 1.7217023362547934e-9.
Completed iteration 1275 with error 1.3524257269637019e-9.
Completed iteration 1300 with error 1.0623533164277887e-9.
Completed iteration 1325 with error 8.344962498796349e-10.
Completed iteration 1350 with error 6.555103126970607e-10.
Completed iteration 1375 with error 5.149147774829999e-10.
Completed iteration 1400 with error 4.044742318853878e-10.
Completed iteration 1425 with error 3.177209606519682e-10.
Completed iteration 1450 with error 2.495754714004761e-10.
Completed iteration 1475 with error 1.9604562417896432e-10.
Completed iteration 1500 with error 1.5399703734431114e-10.
Completed iteration 1525 with error 1.2096723622789796e-10.
Terminated successfully in 1546 iterations.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="_images/081723f341f9b424eaa2d532d0f0234ade3a51403e474e2e43566b78382d0fa5.png" src="_images/081723f341f9b424eaa2d532d0f0234ade3a51403e474e2e43566b78382d0fa5.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">vary_gamma</span><span class="p">(</span><span class="n">savefig</span><span class="o">=</span><span class="nb">true</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 25 with error 0.0079928250990704.
Completed iteration 50 with error 0.0022236699030695473.
Completed iteration 75 with error 0.0007925233675871723.
Completed iteration 100 with error 0.0003700089153120256.
Completed iteration 125 with error 0.00022014006478499049.
Completed iteration 150 with error 0.000152329026353204.
Completed iteration 175 with error 0.00011314688364416625.
Completed iteration 200 with error 8.647303897579839e-5.
Completed iteration 225 with error 6.67984175424241e-5.
Completed iteration 250 with error 5.18016731108073e-5.
Completed iteration 275 with error 4.0227726982866585e-5.
Completed iteration 300 with error 3.1254842565831e-5.
Completed iteration 325 with error 2.4287249895227347e-5.
Completed iteration 350 with error 1.8873788653950285e-5.
Completed iteration 375 with error 1.4667052229189181e-5.
Completed iteration 400 with error 1.1397890212316852e-5.
Completed iteration 425 with error 8.857330340950043e-6.
Completed iteration 450 with error 6.883005259750163e-6.
Completed iteration 475 with error 5.348730677479097e-6.
Completed iteration 500 with error 4.156437363178611e-6.
Completed iteration 525 with error 3.229907427737544e-6.
Completed iteration 550 with error 2.509906823489061e-6.
Completed iteration 575 with error 1.9504018531346645e-6.
Completed iteration 600 with error 1.5156181834008464e-6.
Completed iteration 625 with error 1.1777548307723151e-6.
Completed iteration 650 with error 9.152073523477355e-7.
Completed iteration 675 with error 7.111868747244898e-7.
Completed iteration 700 with error 5.526468194183565e-7.
Completed iteration 725 with error 4.2944879741213526e-7.
Completed iteration 750 with error 3.3371438834528533e-7.
Completed iteration 775 with error 2.593213874746425e-7.
Completed iteration 800 with error 2.0151233481868758e-7.
Completed iteration 825 with error 1.5659029850567663e-7.
Completed iteration 850 with error 1.2168246632526802e-7.
Completed iteration 875 with error 9.455643845690531e-8.
Completed iteration 900 with error 7.347746611152672e-8.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 925 with error 5.709751449423095e-8.
Completed iteration 950 with error 4.436905820526249e-8.
Completed iteration 975 with error 3.447808993861656e-8.
Completed iteration 1000 with error 2.6792065010994293e-8.
Completed iteration 1025 with error 2.0819445056829977e-8.
Completed iteration 1050 with error 1.6178271167177627e-8.
Completed iteration 1075 with error 1.257173076751883e-8.
Completed iteration 1100 with error 9.769177466978363e-9.
Completed iteration 1125 with error 7.591384187932704e-9.
Completed iteration 1150 with error 5.899075006254861e-9.
Completed iteration 1175 with error 4.584023605147536e-9.
Completed iteration 1200 with error 3.5621303684507666e-9.
Completed iteration 1225 with error 2.7680424619092037e-9.
Completed iteration 1250 with error 2.150976285975048e-9.
Completed iteration 1275 with error 1.6714698514164184e-9.
Completed iteration 1300 with error 1.2988572439809332e-9.
Completed iteration 1325 with error 1.0093095248464579e-9.
Completed iteration 1350 with error 7.843090621406645e-10.
Completed iteration 1375 with error 6.094666993305964e-10.
Completed iteration 1400 with error 4.736020464690682e-10.
Completed iteration 1425 with error 3.680240556747094e-10.
Completed iteration 1450 with error 2.8598301504700885e-10.
Completed iteration 1475 with error 2.2222956808093386e-10.
Completed iteration 1500 with error 1.7268875218690027e-10.
Completed iteration 1525 with error 1.3419243494183775e-10.
Completed iteration 1550 with error 1.0427725349870798e-10.
Terminated successfully in 1556 iterations.
Completed iteration 25 with error 0.005805024318952023.
Completed iteration 50 with error 0.0016587166980878143.
Completed iteration 75 with error 0.0009045403638299199.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 100 with error 0.0006103613807980635.
Completed iteration 125 with error 0.0005311884300758241.
Completed iteration 150 with error 0.00043698527493063466.
Completed iteration 175 with error 0.00035198104401934494.
Completed iteration 200 with error 0.00028172941742132807.
Completed iteration 225 with error 0.00022510364302386066.
Completed iteration 250 with error 0.00017979635634590707.
Completed iteration 275 with error 0.0001436170545812132.
Completed iteration 300 with error 0.0001147362910276506.
Completed iteration 325 with error 9.167841288770795e-5.
Completed iteration 350 with error 7.326486227898776e-5.
Completed iteration 375 with error 5.855662116727167e-5.
Completed iteration 400 with error 4.680563708592267e-5.
Completed iteration 425 with error 3.741571258686349e-5.
Completed iteration 450 with error 2.9911412434691087e-5.
Completed iteration 475 with error 2.3913408442099993e-5.
Completed iteration 500 with error 1.9118921097849295e-5.
Completed iteration 525 with error 1.5286186529461787e-5.
Completed iteration 550 with error 1.2222105523429505e-5.
Completed iteration 575 with error 9.772412332020863e-6.
Completed iteration 600 with error 7.813842262560655e-6.
Completed iteration 625 with error 6.24788716541147e-6.
Completed iteration 650 with error 4.995813982278108e-6.
Completed iteration 675 with error 3.994689006692198e-6.
Completed iteration 700 with error 3.1942036058385526e-6.
Completed iteration 725 with error 2.554139072685757e-6.
Completed iteration 750 with error 2.0423414170966936e-6.
Completed iteration 775 with error 1.6331032173244608e-6.
Completed iteration 800 with error 1.3058705052859665e-6.
Completed iteration 825 with error 1.0442092637230616e-6.
Completed iteration 850 with error 8.349793416684292e-7.
Completed iteration 875 with error 6.676740960109839e-7.
Completed iteration 900 with error 5.338924871090001e-7.
Completed iteration 925 with error 4.2691703150410376e-7.
Completed iteration 950 with error 3.413763751680676e-7.
Completed iteration 975 with error 2.729755148589419e-7.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 1000 with error 2.1828008911484176e-7.
Completed iteration 1025 with error 1.7454391376681144e-7.
Completed iteration 1050 with error 1.3957107514173117e-7.
Completed iteration 1075 with error 1.1160566559809126e-7.
Completed iteration 1100 with error 8.924361205586706e-8.
Completed iteration 1125 with error 7.136217905490128e-8.
Completed iteration 1150 with error 5.706359362811497e-8.
Completed iteration 1175 with error 4.5629968914440155e-8.
Completed iteration 1200 with error 3.6487260768325314e-8.
Completed iteration 1225 with error 2.9176445481837732e-8.
Completed iteration 1250 with error 2.3330471332627667e-8.
Completed iteration 1275 with error 1.8655833988745485e-8.
Completed iteration 1300 with error 1.4917836299588316e-8.
Completed iteration 1325 with error 1.1928807275296549e-8.
Completed iteration 1350 with error 9.538678735765416e-9.
Completed iteration 1375 with error 7.627450671066072e-9.
Completed iteration 1400 with error 6.099168059492399e-9.
Completed iteration 1425 with error 4.877101611455714e-9.
Completed iteration 1450 with error 3.899895961723132e-9.
Completed iteration 1475 with error 3.1184890225688378e-9.
Completed iteration 1500 with error 2.4936497311500716e-9.
Completed iteration 1525 with error 1.9940069595492105e-9.
Completed iteration 1550 with error 1.5944754405694539e-9.
Completed iteration 1575 with error 1.2749967748248991e-9.
Completed iteration 1600 with error 1.019530682100367e-9.
Completed iteration 1625 with error 8.152511998815726e-10.
Completed iteration 1650 with error 6.519025319562388e-10.
Completed iteration 1675 with error 5.212834608414596e-10.
Completed iteration 1700 with error 4.168358991307741e-10.
Completed iteration 1725 with error 3.3331604143427285e-10.
Completed iteration 1750 with error 2.6653146356636626e-10.
Completed iteration 1775 with error 2.1312729359124205e-10.
Completed iteration 1800 with error 1.704234531274551e-10.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 1825 with error 1.3627632355905916e-10.
Completed iteration 1850 with error 1.0897172053603299e-10.
Terminated successfully in 1861 iterations.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="_images/422ba2048419a0ebaf088889982ac1fc4d8aff1c89f46fbfb33e09d83f00eb03.png" src="_images/422ba2048419a0ebaf088889982ac1fc4d8aff1c89f46fbfb33e09d83f00eb03.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">vary_alpha</span><span class="p">(</span><span class="n">savefig</span><span class="o">=</span><span class="nb">true</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 25 with error 0.00705978038298638.
Completed iteration 50 with error 0.0016244720239249055.
Completed iteration 75 with error 0.0004469052464325385.
Completed iteration 100 with error 0.00019885551337017748.
Completed iteration 125 with error 0.0001136541590511797.
Completed iteration 150 with error 9.197108433633971e-5.
Completed iteration 175 with error 7.72108640880731e-5.
Completed iteration 200 with error 6.18447413132106e-5.
Completed iteration 225 with error 4.877743776865451e-5.
Completed iteration 250 with error 3.826910525028815e-5.
Completed iteration 275 with error 2.997076483612915e-5.
Completed iteration 300 with error 2.3457884571698173e-5.
Completed iteration 325 with error 1.835697143692805e-5.
Completed iteration 350 with error 1.4364647692000077e-5.
Completed iteration 375 with error 1.1240612030949393e-5.
Completed iteration 400 with error 8.796119907339417e-6.
Completed iteration 425 with error 6.8833377468990875e-6.
Completed iteration 450 with error 5.386578291188826e-6.
Completed iteration 475 with error 4.215331874668493e-6.
Completed iteration 500 with error 3.298788607386527e-6.
Completed iteration 525 with error 2.581548538493905e-6.
Completed iteration 550 with error 2.0202659163359726e-6.
Completed iteration 575 with error 1.581024815511256e-6.
Completed iteration 600 with error 1.2372866600163235e-6.
Completed iteration 625 with error 9.682848662873056e-7.
Completed iteration 650 with error 7.577690683824301e-7.
Completed iteration 675 with error 5.930227031658575e-7.
Completed iteration 700 with error 4.640943993550195e-7.
Completed iteration 725 with error 3.6319659924011205e-7.
Completed iteration 750 with error 2.8423500553209635e-7.
Completed iteration 775 with error 2.2244037634067126e-7.
Completed iteration 800 with error 1.7408040631217148e-7.
Completed iteration 825 with error 1.362342560984331e-7.
Completed iteration 850 with error 1.0661612370732598e-7.
Completed iteration 875 with error 8.343716673131496e-8.
Completed iteration 900 with error 6.529746099381839e-8.
Completed iteration 925 with error 5.1101434639377885e-8.
Completed iteration 950 with error 3.9991707057041026e-8.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 975 with error 3.1297297642396416e-8.
Completed iteration 1000 with error 2.449310043672881e-8.
Completed iteration 1025 with error 1.9168171716543725e-8.
Completed iteration 1050 with error 1.5000912290119572e-8.
Completed iteration 1075 with error 1.1739636152086064e-8.
Completed iteration 1100 with error 9.187378857689055e-9.
Completed iteration 1125 with error 7.1899948217435394e-9.
Completed iteration 1150 with error 5.626853871731896e-9.
Completed iteration 1175 with error 4.40354752662131e-9.
Completed iteration 1200 with error 3.4461931086582354e-9.
Completed iteration 1225 with error 2.6969735333892686e-9.
Completed iteration 1250 with error 2.1106374425983176e-9.
Completed iteration 1275 with error 1.651774939048778e-9.
Completed iteration 1300 with error 1.292670193109302e-9.
Completed iteration 1325 with error 1.0116376625290968e-9.
Completed iteration 1350 with error 7.917018152170385e-10.
Completed iteration 1375 with error 6.195819413079562e-10.
Completed iteration 1400 with error 4.848819123992598e-10.
Completed iteration 1425 with error 3.794662362111012e-10.
Completed iteration 1450 with error 2.9696800574186e-10.
Completed iteration 1475 with error 2.3240565028004312e-10.
Completed iteration 1500 with error 1.8187962247395717e-10.
Completed iteration 1525 with error 1.423379192289076e-10.
Completed iteration 1550 with error 1.1139311695274046e-10.
Terminated successfully in 1563 iterations.
Completed iteration 25 with error 0.007135885868511105.
Completed iteration 50 with error 0.0016055933560223945.
Completed iteration 75 with error 0.0004403182419771001.
Completed iteration 100 with error 0.00019170939378654328.
Completed iteration 125 with error 0.00010760706432144662.
Completed iteration 150 with error 7.947964446186617e-5.
Completed iteration 175 with error 6.72775698025152e-5.
Completed iteration 200 with error 5.4081885924706086e-5.
Completed iteration 225 with error 4.274895119582567e-5.
Completed iteration 250 with error 3.3598178110327837e-5.
Completed iteration 275 with error 2.6354627015834353e-5.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 300 with error 2.0659148304957853e-5.
Completed iteration 325 with error 1.6191113263452905e-5.
Completed iteration 350 with error 1.2688664559057372e-5.
Completed iteration 375 with error 9.943784911037312e-6.
Completed iteration 400 with error 7.792746775203696e-6.
Completed iteration 425 with error 6.107082487050164e-6.
Completed iteration 450 with error 4.786093088071652e-6.
Completed iteration 475 with error 3.7508697376953393e-6.
Completed iteration 500 with error 2.9395824157063544e-6.
Completed iteration 525 with error 2.303782836721169e-6.
Completed iteration 550 with error 1.8055071033806769e-6.
Completed iteration 575 with error 1.415005903782074e-6.
Completed iteration 600 with error 1.1089664067043259e-6.
Completed iteration 625 with error 8.691192774357148e-7.
Completed iteration 650 with error 6.811473081125285e-7.
Completed iteration 675 with error 5.338303132873534e-7.
Completed iteration 700 with error 4.1837509945352735e-7.
Completed iteration 725 with error 3.278904354697687e-7.
Completed iteration 750 with error 2.569756183401495e-7.
Completed iteration 775 with error 2.013980635595658e-7.
Completed iteration 800 with error 1.5784063389645553e-7.
Completed iteration 825 with error 1.237036351131593e-7.
Completed iteration 850 with error 9.694964053785782e-8.
Completed iteration 875 with error 7.598187723445449e-8.
Completed iteration 900 with error 5.954892090542785e-8.
Completed iteration 925 with error 4.6670001641047065e-8.
Completed iteration 950 with error 3.657646874266618e-8.
Completed iteration 975 with error 2.8665911644409903e-8.
Completed iteration 1000 with error 2.2466207783011782e-8.
Completed iteration 1025 with error 1.760734180678014e-8.
Completed iteration 1050 with error 1.3799324571905913e-8.
Completed iteration 1075 with error 1.0814884765508737e-8.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 1100 with error 8.47590220232064e-9.
Completed iteration 1125 with error 6.6427816580727495e-9.
Completed iteration 1150 with error 5.2061188693386384e-9.
Completed iteration 1175 with error 4.080168647391247e-9.
Completed iteration 1200 with error 3.1977336334421125e-9.
Completed iteration 1225 with error 2.5061457353814376e-9.
Completed iteration 1250 with error 1.9641301918227327e-9.
Completed iteration 1275 with error 1.5393402108543341e-9.
Completed iteration 1300 with error 1.2064202969952476e-9.
Completed iteration 1325 with error 9.45502121041386e-10.
Completed iteration 1350 with error 7.410141389385672e-10.
Completed iteration 1375 with error 5.807518910216913e-10.
Completed iteration 1400 with error 4.551501397997981e-10.
Completed iteration 1425 with error 3.567128814552234e-10.
Completed iteration 1450 with error 2.7956503778625574e-10.
Completed iteration 1475 with error 2.191020698205648e-10.
Completed iteration 1500 with error 1.717159747727237e-10.
Completed iteration 1525 with error 1.3457812642059253e-10.
Completed iteration 1550 with error 1.0547274165162435e-10.
Terminated successfully in 1557 iterations.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="_images/99cb7b7bc1baa89097791e6833cb3374296c7560676cb769c707f181bb28c162.png" src="_images/99cb7b7bc1baa89097791e6833cb3374296c7560676cb769c707f181bb28c162.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "julia-1.9"
        },
        kernelOptions: {
            name: "julia-1.9",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'julia-1.9'</script>

                    </div>
                    
                </main> <!-- .page__content -->
                


                <footer class="qe-page__footer">

                    <p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png"></a></p>

                    <p>Creative Commons License &ndash; This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International.</p>

                </footer> <!-- .page__footer -->

            </div> <!-- .page -->

            

            
            <div class="qe-sidebar bd-sidebar inactive" id="site-navigation">

                <div class="qe-sidebar__header">


                    Contents

                </div>

                <nav class="qe-sidebar__nav" id="qe-sidebar-nav" aria-label="Main navigation">
                    <ul class="current nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="introductions.html">
   Introductions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="operators_fixed_points.html">
   Operators and Fixed Points
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="markov_dynamics.html">
   Markov Dynamics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="optimal_stopping.html">
   Optimal Stopping
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="markov_decision_processes.html">
   Markov Decision Processes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stochastic_discounting.html">
   Stochastic Discounting
  </a>
 </li>
 <li class="toctree-l1 current active active">
  <a class="current reference internal" href="#">
   Nonlinear Valuation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="recursive_decision_processes.html">
   Recursive Decision Processes
  </a>
 </li>
</ul>

                </nav>

                <div class="qe-sidebar__footer">

                </div>

            </div> <!-- .sidebar -->
            
        </div> <!-- .main -->

        <div class="qe-toolbar">

            <div class="qe-toolbar__inner">

                <ul class="qe-toolbar__main">
                    <li data-tippy-content="Table of Contents" class="btn__sidebar"><i data-feather="menu"></i></li>
                    <li data-tippy-content="Home"><a href="intro.html"><i data-feather="home"></i></a></li>
                    <li class="btn__qelogo"><a href="https://quantecon.org" title=""><span class="show-for-sr">QuantEcon</span></a></li>
                </ul>

                <ul class="qe-toolbar__links">
                    <li class="btn__search">
                        <form action="search.html" method="get">
                            <input type="search" class="form-control" name="q" id="search-input" placeholder="Search..." aria-label="Search..." autocomplete="off" accesskey="k">
                            <i data-feather="search" id="search-icon"></i>
                        </form>
                    </li>
                    <li data-tippy-content="Fullscreen" class="btn__fullscreen"><i data-feather="maximize"></i></li>
                    <li data-tippy-content="Increase font size" class="btn__plus"><i data-feather="plus-circle"></i></li>
                    <li data-tippy-content="Decrease font size" class="btn__minus"><i data-feather="minus-circle"></i></li>
                    <li data-tippy-content="Change contrast" class="btn__contrast"><i data-feather="sunset"></i></li>
                        <li data-tippy-content="Download PDF" onClick="window.print()"><i data-feather="file"></i></li>
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/orectique/book-dp1/blob/main/julia_version/juliabook/nonlinear_valuation.md" download><i data-feather="github"></i></a></li>
                </ul>

            </div>

        </div> <!-- .toolbar -->
        <div id="downloadPDFModal" style="display: none;">
            <ul class="pdf-options" style="display: block;">
                <li class="download-pdf-book" onClick="window.print()">
                    <p>Lecture (PDF)</p>
                </li>
                <li class="download-pdf-file">
                    <a href="" download><p>Book (PDF)</p></a>
                </li>
            </ul>
        </div>
        <div id="settingsModal" style="display: none;">
            <p class="modal-title"> Notebook Launcher </p>
            <div class="modal-desc">
            <p>
                Choose public or private cloud service for "Launch" button.
            </p>
            </div>
            <p class="modal-subtitle">Select a server</p>
            <ul class="modal-servers">
            <li class="active launcher-public">
                <span class="label">Public</span>
                <select id="launcher-public-input">
                
                </select>
                <i class="fas fa-check-circle"></i>
            </li>
            <li class="launcher-private">
                <span class="label">Private</span>
                <input type="text" id="launcher-private-input" data-repourl="" data-urlpath="" data-branch=>
                <i class="fas fa-check-circle"></i>
            </li>
            </ul>
            <p class="launch"><a href="" id="advancedLaunchButton" target="_blank">Launch Notebook</a></p>
            <script>
                // QuantEcon Notebook Launcher
                const launcherTypeElements = document.querySelectorAll('#settingsModal .modal-servers li');
                // Highlight the server type if previous selection exists
                if (typeof localStorage.launcherType !== 'undefined') {
                  for (var i = 0; i < launcherTypeElements.length; i++) {
                    launcherTypeElements[i].classList.remove('active');
                    if ( launcherTypeElements[i].classList.contains(localStorage.launcherType) ) {
                      launcherTypeElements[i].classList.add('active');
                    }
                  }
                }
                // Highlight server type on click and set local storage value
                for (var i = 0; i < launcherTypeElements.length; i++) {
                  launcherTypeElements[i].addEventListener('click', function() {
                    for (var j = 0; j < launcherTypeElements.length; j++) {
                      launcherTypeElements[j].classList.remove('active');
                    }
                    this.classList.add('active');
                    if ( this.classList.contains('launcher-private') ) {
                      localStorage.launcherType = 'launcher-private';
                    } else if ( this.classList.contains('launcher-public') ) {
                      localStorage.launcherType = 'launcher-public';
                    }
                    setLaunchServer();
                  })
                }
                const launcherPublic = document.getElementById('launcher-public-input');
                const launcherPrivate = document.getElementById('launcher-private-input');
                const pageName = "nonlinear_valuation";
                const repoURL = "";
                const urlPath = "";
                const branch = ""
                const launchNotebookLink = document.getElementById('advancedLaunchButton');

                // Highlight public server option if previous selection exists
                if (typeof localStorage.launcherPublic !== 'undefined') {
                  launcherPublic.value = localStorage.launcherPublic;
                }
                // Update local storage upon public server selection
                launcherPublic.addEventListener('change', (event) => {
                  setLaunchServer();
                });
                // Populate private server input if previous entry exists
                if (typeof localStorage.launcherPrivate !== 'undefined') {
                  launcherPrivate.value = localStorage.launcherPrivate;
                }
                // Update local storage when a private server is entered
                launcherPrivate.addEventListener('input', (event) => {
                  setLaunchServer();
                });

                // Function to update the "Launch Notebook" link href
                function setLaunchServer() {
                  launchNotebookLink.removeAttribute("style")
                  if ( localStorage.launcherType == 'launcher-private' ) {
                    let repoPrefix = "/jupyter/hub/user-redirect/git-pull?repo=" + repoURL + "&branch=" + branch + "&urlpath=" + urlPath;
                    launcherPrivateValue = launcherPrivate.value
                    if (!launcherPrivateValue) {
                        launchNotebookLink.removeAttribute("href")
                        launchNotebookLink.style.background = "grey"
                        return
                    }
                    localStorage.launcherPrivate = launcherPrivateValue;
                    privateServer = localStorage.launcherPrivate.replace(/\/$/, "")
                    if (!privateServer.includes("http")) {
                        privateServer = "http://" + privateServer
                    }
                    launchNotebookLinkURL = privateServer + repoPrefix;
                  } else if ( localStorage.launcherType == 'launcher-public' ) {
                    launcherPublicValue = launcherPublic.options[launcherPublic.selectedIndex].value;
                    localStorage.launcherPublic = launcherPublicValue;
                    launchNotebookLinkURL = localStorage.launcherPublic;
                  }
                  if (launchNotebookLinkURL) launchNotebookLink.href = launchNotebookLinkURL;
                }
                // Check if user has previously selected a server
                if ( (typeof localStorage.launcherPrivate !== 'undefined') || (typeof localStorage.launcherPublic !== 'undefined') ) {
                  setLaunchServer();
                }
                </script>

        </div>

    </div> <!-- .wrapper-->
  </body>
</html>