

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Chapter 4: Optimal Stopping &#8212; Dynamic Programming</title>
    <script src="https://unpkg.com/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.1/dist/tippy-bundle.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
        <script>
            MathJax = {
            loader: {load: ['[tex]/boldsymbol', '[tex]/textmacros']},
            tex: {
                packages: {'[+]': ['boldsymbol', 'textmacros']},
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                processEscapes: true,
                macros: {
                    "argmax" : "arg\\,max",
                    "argmin" : "arg\\,min",
                    "col"    : "col",
                    "Span"   :  "span",
                    "epsilon": "\\varepsilon",
                    "EE": "\\mathbb{E}",
                    "PP": "\\mathbb{P}",
                    "RR": "\\mathbb{R}",
                    "NN": "\\mathbb{N}",
                    "ZZ": "\\mathbb{Z}",
                    "aA": "\\mathcal{A}",
                    "bB": "\\mathcal{B}",
                    "cC": "\\mathcal{C}",
                    "dD": "\\mathcal{D}",
                    "eE": "\\mathcal{E}",
                    "fF": "\\mathcal{F}",
                    "gG": "\\mathcal{G}",
                    "hH": "\\mathcal{H}",
                }
            },
            svg: {
                fontCache: 'global',
                scale: 0.92,
                displayAlign: "center",
            },
            };
        </script>
    
    
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/quantecon-book-theme.b1c2e4f636e57c481a96e252d9ca7e4e.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />


    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script src="../_static/quantecon-book-theme.ef2ef6c3e8da75e1e736fb5fce08cde6.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'jl/optimal_stopping';</script>
    <link rel="shortcut icon" href="../_static/lectures-favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Chapter 5: Markov Decision Processes" href="markov_decision_processes.html" />
    <link rel="prev" title="Chapter 3: Markov Dynamics" href="markov_dynamics.html" />

<!-- Normal Meta Tags -->
<meta name="author" context="Thomas J. Sargent &amp; John Stachurski" />
<meta name="keywords" content="" />
<meta name="description" content=Chapter 4: Optimal Stopping  Contents  Chapter 4: Optimal Stopping  firm_exit.jl  american_option.jl  firm_exit.jl  &#34;&#34;&#34; Firm valuation with exit option.  &#34;&#34;&#34;  u />

<!-- Twitter tags -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@quantecon" />
<meta name="twitter:title" content="Chapter 4: Optimal Stopping"/>
<meta name="twitter:description" content="Chapter 4: Optimal Stopping  Contents  Chapter 4: Optimal Stopping  firm_exit.jl  american_option.jl  firm_exit.jl  &#34;&#34;&#34; Firm valuation with exit option.  &#34;&#34;&#34;  u">
<meta name="twitter:creator" content="@quantecon">
<meta name="twitter:image" content="https://assets.quantecon.org/img/qe-twitter-logo.png">

<!-- Opengraph tags -->
<meta property="og:title" content="Chapter 4: Optimal Stopping" />
<meta property="og:type" content="website" />
<meta property="og:url" content="None" />
<meta property="og:image" content="https://assets.quantecon.org/img/qe-og-logo.png" />
<meta property="og:description" content="Chapter 4: Optimal Stopping  Contents  Chapter 4: Optimal Stopping  firm_exit.jl  american_option.jl  firm_exit.jl  &#34;&#34;&#34; Firm valuation with exit option.  &#34;&#34;&#34;  u" />
<meta property="og:site_name" content="Dynamic Programming" />
<meta name="theme-color" content="#ffffff" />

  </head>
<body>


    <span id="top"></span>

    <div class="qe-wrapper">

        <div class="qe-main">

            <div class="qe-page" id=jl/optimal_stopping>

                <div class="qe-page__toc">

                    <div class="inner">

                        
                        <div class="qe-page__toc-header">
                            On this page
                        </div>


                        <nav id="bd-toc-nav" class="qe-page__toc-nav">
                            <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#firm-exit-jl">firm_exit.jl</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#american-option-jl">american_option.jl</a></li>
</ul>
                            <p class="logo">
                                
                                    
                                    <a href=https://quantecon.org><img src="../_static/qe-logo.png" class="logo" alt="logo"></a>
                                    
                                
                            </p>

                            <p class="powered">Powered by <a href="https://jupyterbook.org/">Jupyter Book</a></p>

                        </nav>

                        <div class="qe-page__toc-footer">
                            
                            
                            <p><a href="#top"><strong>Back to top</strong></a></p>
                        </div>

                    </div>

                </div>

                <div class="qe-page__header">

                    <div class="qe-page__header-copy">

                        <p class="qe-page__header-heading"><a href="../intro.html">Dynamic Programming</a></p>

                        <p class="qe-page__header-subheading">Chapter 4: Optimal Stopping</p>

                    </div>

                    <p class="qe-page__header-authors">Thomas J. Sargent & John Stachurski</p>

                </div> <!-- .page__header -->



                
                <main class="qe-page__content" role="main">
                    
                    <div>
                        
  <section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1><a class="toc-backref" href="#id2">Chapter 4: Optimal Stopping</a><a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#id1" id="id2">Chapter 4: Optimal Stopping</a></p>
<ul>
<li><p><a class="reference internal" href="#firm-exit-jl" id="id3">firm_exit.jl</a></p></li>
<li><p><a class="reference internal" href="#american-option-jl" id="id4">american_option.jl</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="firm-exit-jl">
<h2><a class="toc-backref" href="#id3">firm_exit.jl</a><a class="headerlink" href="#firm-exit-jl" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;&quot;&quot;</span>
<span class="s">Firm valuation with exit option.</span>

<span class="s">&quot;&quot;&quot;</span>

<span class="k">using</span><span class="w"> </span><span class="n">QuantEcon</span><span class="p">,</span><span class="w"> </span><span class="n">LinearAlgebra</span>
<span class="n">include</span><span class="p">(</span><span class="s">&quot;s_approx.jl&quot;</span><span class="p">)</span>

<span class="s">&quot;Creates an instance of the firm exit model.&quot;</span>
<span class="k">function</span><span class="w"> </span><span class="n">create_exit_model</span><span class="p">(;</span>
<span class="w">        </span><span class="n">n</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="w">                  </span><span class="c"># productivity grid size</span>
<span class="w">        </span><span class="n">ρ</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span><span class="w"> </span><span class="n">μ</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">ν</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="w">   </span><span class="c"># persistence, mean and volatility</span>
<span class="w">        </span><span class="n">β</span><span class="o">=</span><span class="mf">0.98</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="o">=</span><span class="mf">100.0</span><span class="w">         </span><span class="c"># discount factor and scrap value</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="n">mc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tauchen</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ρ</span><span class="p">,</span><span class="w"> </span><span class="n">ν</span><span class="p">,</span><span class="w"> </span><span class="n">μ</span><span class="p">)</span>
<span class="w">    </span><span class="n">z_vals</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mc</span><span class="o">.</span><span class="n">state_values</span><span class="p">,</span><span class="w"> </span><span class="n">mc</span><span class="o">.</span><span class="n">p</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">z_vals</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">β</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="k">end</span>


<span class="s">&quot;Compute value of firm without exit option.&quot;</span>
<span class="k">function</span><span class="w"> </span><span class="n">no_exit_value</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="w">    </span><span class="p">(;</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">z_vals</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">β</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">I</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">β</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Q</span><span class="p">)</span><span class="w"> </span><span class="o">\</span><span class="w"> </span><span class="n">z_vals</span>
<span class="k">end</span>

<span class="s">&quot; The Bellman operator Tv = max{s, π + β Q v}.&quot;</span>
<span class="k">function</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">)</span>
<span class="w">    </span><span class="p">(;</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">z_vals</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">β</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span>
<span class="w">    </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z_vals</span><span class="w"> </span><span class="o">.+</span><span class="w"> </span><span class="n">β</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Q</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">max</span><span class="o">.</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">)</span>
<span class="k">end</span>

<span class="s">&quot; Get a v-greedy policy.&quot;</span>
<span class="k">function</span><span class="w"> </span><span class="n">get_greedy</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">)</span>
<span class="w">    </span><span class="p">(;</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">z_vals</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">β</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span>
<span class="w">    </span><span class="n">σ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">.&gt;=</span><span class="w"> </span><span class="n">z_vals</span><span class="w"> </span><span class="o">.+</span><span class="w"> </span><span class="n">β</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Q</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">σ</span>
<span class="k">end</span>

<span class="s">&quot;Solve by VFI.&quot;</span>
<span class="k">function</span><span class="w"> </span><span class="n">vfi</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="n">v_init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">no_exit_value</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="w">    </span><span class="n">v_star</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">successive_approx</span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">),</span><span class="w"> </span><span class="n">v_init</span><span class="p">)</span>
<span class="w">    </span><span class="n">σ_star</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_greedy</span><span class="p">(</span><span class="n">v_star</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v_star</span><span class="p">,</span><span class="w"> </span><span class="n">σ_star</span>
<span class="k">end</span>


<span class="c"># Plots</span>

<span class="k">using</span><span class="w"> </span><span class="n">PyPlot</span>
<span class="k">using</span><span class="w"> </span><span class="n">LaTeXStrings</span>
<span class="n">PyPlot</span><span class="o">.</span><span class="n">matplotlib</span><span class="p">[</span><span class="ss">:rc</span><span class="p">](</span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">usetex</span><span class="o">=</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="c"># allow tex rendering</span>
<span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span>


<span class="k">function</span><span class="w"> </span><span class="n">plot_val</span><span class="p">(;</span><span class="w"> </span><span class="n">savefig</span><span class="o">=</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span>
<span class="w">                     </span><span class="n">figname</span><span class="o">=</span><span class="s">&quot;figures/firm_exit_1.pdf&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">fig</span><span class="p">,</span><span class="w"> </span><span class="n">ax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mf">5.2</span><span class="p">))</span>

<span class="w">    </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_exit_model</span><span class="p">()</span>
<span class="w">    </span><span class="p">(;</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">z_vals</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">β</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span>

<span class="w">    </span><span class="n">v_star</span><span class="p">,</span><span class="w"> </span><span class="n">σ_star</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vfi</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="w">    </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z_vals</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">β</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Q</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_star</span>

<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z_vals</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="sa">L</span><span class="s">&quot;h^*&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z_vals</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="sa">L</span><span class="s">&quot;s&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z_vals</span><span class="p">,</span><span class="w"> </span><span class="n">v_star</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;k--&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="sa">L</span><span class="s">&quot;v^*&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">L</span><span class="s">&quot;z&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">savefig</span>
<span class="w">        </span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>
<span class="k">end</span>


<span class="k">function</span><span class="w"> </span><span class="n">plot_comparison</span><span class="p">(;</span><span class="w"> </span><span class="n">savefig</span><span class="o">=</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span>
<span class="w">                     </span><span class="n">figname</span><span class="o">=</span><span class="s">&quot;figures/firm_exit_2.pdf&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">fig</span><span class="p">,</span><span class="w"> </span><span class="n">ax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mf">5.2</span><span class="p">))</span>

<span class="w">    </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_exit_model</span><span class="p">()</span>
<span class="w">    </span><span class="p">(;</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">z_vals</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">β</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span>

<span class="w">    </span><span class="n">v_star</span><span class="p">,</span><span class="w"> </span><span class="n">σ_star</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vfi</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="w">    </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">no_exit_value</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z_vals</span><span class="p">,</span><span class="w"> </span><span class="n">v_star</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;k-&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="sa">L</span><span class="s">&quot;v^*&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z_vals</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s">&quot;no-exit value&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
<span class="w">    </span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">L</span><span class="s">&quot;z&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">savefig</span>
<span class="w">        </span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>plot_comparison (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">plot_val</span><span class="p">(</span><span class="n">savefig</span><span class="o">=</span><span class="nb">true</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 25 with error 0.03580715900042719.
Completed iteration 50 with error 0.017225068626771645.
Completed iteration 75 with error 0.00676835562268252.
Completed iteration 100 with error 0.002642877005840205.
Completed iteration 125 with error 0.001043441654843491.
Completed iteration 150 with error 0.0004139022964579908.
Completed iteration 175 with error 0.00016428959624192885.
Completed iteration 200 with error 6.521647846113865e-5.
Completed iteration 225 with error 2.5888622744218992e-5.
Completed iteration 250 with error 1.027687515886555e-5.
Completed iteration 275 with error 4.079559587921722e-6.
Completed iteration 300 with error 1.6194423579918293e-6.
Terminated successfully in 315 iterations.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../_images/2ac64997eec2c3272b60cf7962e53bc7095cbc69b8ca27b71a8b54365d3600e8.png" src="../_images/2ac64997eec2c3272b60cf7962e53bc7095cbc69b8ca27b71a8b54365d3600e8.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">plot_comparison</span><span class="p">(</span><span class="n">savefig</span><span class="o">=</span><span class="nb">true</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 25 with error 0.03580715900042719.
Completed iteration 50 with error 0.017225068626771645.
Completed iteration 75 with error 0.00676835562268252.
Completed iteration 100 with error 0.002642877005840205.
Completed iteration 125 with error 0.001043441654843491.
Completed iteration 150 with error 0.0004139022964579908.
Completed iteration 175 with error 0.00016428959624192885.
Completed iteration 200 with error 6.521647846113865e-5.
Completed iteration 225 with error 2.5888622744218992e-5.
Completed iteration 250 with error 1.027687515886555e-5.
Completed iteration 275 with error 4.079559587921722e-6.
Completed iteration 300 with error 1.6194423579918293e-6.
Terminated successfully in 315 iterations.
</pre></div>
</div>
<img alt="../_images/031f726ea5ba89aabbadb023abc455ac10f2d7c719be456dc194f3eea09a5885.png" src="../_images/031f726ea5ba89aabbadb023abc455ac10f2d7c719be456dc194f3eea09a5885.png" />
</div>
</div>
</section>
<section id="american-option-jl">
<h2><a class="toc-backref" href="#id4">american_option.jl</a><a class="headerlink" href="#american-option-jl" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;&quot;&quot;</span>
<span class="s">Valuation for finite-horizon American call options in discrete time.</span>

<span class="s">&quot;&quot;&quot;</span>

<span class="n">include</span><span class="p">(</span><span class="s">&quot;s_approx.jl&quot;</span><span class="p">)</span>
<span class="k">using</span><span class="w"> </span><span class="n">QuantEcon</span><span class="p">,</span><span class="w"> </span><span class="n">LinearAlgebra</span><span class="p">,</span><span class="w"> </span><span class="n">IterTools</span>

<span class="s">&quot;Creates an instance of the option model with log S_t = Z_t + W_t.&quot;</span>
<span class="k">function</span><span class="w"> </span><span class="n">create_american_option_model</span><span class="p">(;</span>
<span class="w">        </span><span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="n">μ</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span><span class="w">  </span><span class="c"># Markov state grid size and mean value</span>
<span class="w">        </span><span class="n">ρ</span><span class="o">=</span><span class="mf">0.98</span><span class="p">,</span><span class="w"> </span><span class="n">ν</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="w">  </span><span class="c"># persistence and volatility for Markov state</span>
<span class="w">        </span><span class="n">s</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="w">          </span><span class="c"># volatility parameter for W_t</span>
<span class="w">        </span><span class="n">r</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="w">         </span><span class="c"># interest rate </span>
<span class="w">        </span><span class="n">K</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="w">  </span><span class="c"># strike price and expiration date</span>
<span class="w">    </span><span class="n">t_vals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">collect</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="n">mc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tauchen</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ρ</span><span class="p">,</span><span class="w"> </span><span class="n">ν</span><span class="p">)</span>
<span class="w">    </span><span class="n">z_vals</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mc</span><span class="o">.</span><span class="n">state_values</span><span class="w"> </span><span class="o">.+</span><span class="w"> </span><span class="n">μ</span><span class="p">,</span><span class="w"> </span><span class="n">mc</span><span class="o">.</span><span class="n">p</span>
<span class="w">    </span><span class="n">w_vals</span><span class="p">,</span><span class="w"> </span><span class="n">φ</span><span class="p">,</span><span class="w"> </span><span class="n">β</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="o">-</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="p">)</span>
<span class="w">    </span><span class="n">e</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">i_w</span><span class="p">,</span><span class="w"> </span><span class="n">i_z</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">≤</span><span class="w"> </span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">z_vals</span><span class="p">[</span><span class="n">i_z</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">w_vals</span><span class="p">[</span><span class="n">i_w</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">K</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="n">t_vals</span><span class="p">,</span><span class="w"> </span><span class="n">z_vals</span><span class="p">,</span><span class="w"> </span><span class="n">w_vals</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">φ</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">β</span><span class="p">,</span><span class="w"> </span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
<span class="k">end</span>

<span class="s">&quot;The continuation value operator.&quot;</span>
<span class="k">function</span><span class="w"> </span><span class="n">C</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">)</span>
<span class="w">    </span><span class="p">(;</span><span class="w"> </span><span class="n">t_vals</span><span class="p">,</span><span class="w"> </span><span class="n">z_vals</span><span class="p">,</span><span class="w"> </span><span class="n">w_vals</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">φ</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">β</span><span class="p">,</span><span class="w"> </span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span>
<span class="w">    </span><span class="n">Ch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">similar</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
<span class="w">    </span><span class="n">z_idx</span><span class="p">,</span><span class="w"> </span><span class="n">w_idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eachindex</span><span class="p">(</span><span class="n">z_vals</span><span class="p">),</span><span class="w"> </span><span class="n">eachindex</span><span class="p">(</span><span class="n">w_vals</span><span class="p">)</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">i_z</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">product</span><span class="p">(</span><span class="n">t_vals</span><span class="p">,</span><span class="w"> </span><span class="n">z_idx</span><span class="p">)</span>
<span class="w">        </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i_w′</span><span class="p">,</span><span class="w"> </span><span class="n">i_z′</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">product</span><span class="p">(</span><span class="n">w_idx</span><span class="p">,</span><span class="w"> </span><span class="n">z_idx</span><span class="p">)</span>
<span class="w">            </span><span class="n">t′</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">e</span><span class="p">(</span><span class="n">t′</span><span class="p">,</span><span class="w"> </span><span class="n">i_w′</span><span class="p">,</span><span class="w"> </span><span class="n">i_z′</span><span class="p">),</span><span class="w"> </span><span class="n">h</span><span class="p">[</span><span class="n">t′</span><span class="p">,</span><span class="w"> </span><span class="n">i_z′</span><span class="p">])</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>
<span class="w">                       </span><span class="n">Q</span><span class="p">[</span><span class="n">i_z</span><span class="p">,</span><span class="w"> </span><span class="n">i_z′</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">φ</span><span class="p">[</span><span class="n">i_w′</span><span class="p">]</span>
<span class="w">        </span><span class="k">end</span>
<span class="w">        </span><span class="n">Ch</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">i_z</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">β</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">out</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Ch</span>
<span class="k">end</span>

<span class="s">&quot;Compute the continuation value function by successive approx.&quot;</span>
<span class="k">function</span><span class="w"> </span><span class="n">compute_cvf</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="n">h_init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">t_vals</span><span class="p">),</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">z_vals</span><span class="p">))</span>
<span class="w">    </span><span class="n">h_star</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">successive_approx</span><span class="p">(</span><span class="n">h</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">C</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">),</span><span class="w"> </span><span class="n">h_init</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">h_star</span>
<span class="k">end</span>


<span class="c"># Plots</span>

<span class="k">using</span><span class="w"> </span><span class="n">PyPlot</span>
<span class="k">using</span><span class="w"> </span><span class="n">LaTeXStrings</span>
<span class="n">PyPlot</span><span class="o">.</span><span class="n">matplotlib</span><span class="p">[</span><span class="ss">:rc</span><span class="p">](</span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">usetex</span><span class="o">=</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="c"># allow tex rendering</span>
<span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span>


<span class="k">function</span><span class="w"> </span><span class="n">plot_contours</span><span class="p">(;</span><span class="w"> </span><span class="n">savefig</span><span class="o">=</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span>
<span class="w">                         </span><span class="n">figname</span><span class="o">=</span><span class="s">&quot;figures/american_option_1.pdf&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_american_option_model</span><span class="p">()</span>
<span class="w">    </span><span class="p">(;</span><span class="w"> </span><span class="n">t_vals</span><span class="p">,</span><span class="w"> </span><span class="n">z_vals</span><span class="p">,</span><span class="w"> </span><span class="n">w_vals</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">φ</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">β</span><span class="p">,</span><span class="w"> </span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span>
<span class="w">    </span><span class="n">h_star</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compute_cvf</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

<span class="w">    </span><span class="n">fig</span><span class="p">,</span><span class="w"> </span><span class="n">axes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">))</span>
<span class="w">    </span><span class="n">z_idx</span><span class="p">,</span><span class="w"> </span><span class="n">w_idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eachindex</span><span class="p">(</span><span class="n">z_vals</span><span class="p">),</span><span class="w"> </span><span class="n">eachindex</span><span class="p">(</span><span class="n">w_vals</span><span class="p">)</span>
<span class="w">    </span><span class="n">H</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">w_vals</span><span class="p">),</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">z_vals</span><span class="p">))</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ax_index</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">zip</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">195</span><span class="p">,</span><span class="w"> </span><span class="mi">199</span><span class="p">))</span>

<span class="w">        </span><span class="n">ax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">axes</span><span class="p">[</span><span class="n">ax_index</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i_w</span><span class="p">,</span><span class="w"> </span><span class="n">i_z</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">product</span><span class="p">(</span><span class="n">w_idx</span><span class="p">,</span><span class="w"> </span><span class="n">z_idx</span><span class="p">)</span>
<span class="w">            </span><span class="n">H</span><span class="p">[</span><span class="n">i_w</span><span class="p">,</span><span class="w"> </span><span class="n">i_z</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">i_w</span><span class="p">,</span><span class="w"> </span><span class="n">i_z</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">h_star</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">i_z</span><span class="p">]</span>
<span class="w">        </span><span class="k">end</span>

<span class="w">        </span><span class="n">cs1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">w_vals</span><span class="p">,</span><span class="w"> </span><span class="n">z_vals</span><span class="p">,</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">H</span><span class="p">),</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="w">        </span><span class="n">ctr1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">w_vals</span><span class="p">,</span><span class="w"> </span><span class="n">z_vals</span><span class="p">,</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">H</span><span class="p">),</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">])</span>
<span class="w">        </span><span class="n">plt</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">ctr1</span><span class="p">,</span><span class="w"> </span><span class="n">inline</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="w">        </span><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cs1</span><span class="p">,</span><span class="w"> </span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span><span class="w"> </span><span class="c">#, format=&quot;%.6f&quot;)</span>

<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">L</span><span class="s">&quot;t=&quot;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="s">&quot;</span><span class="si">$t</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">L</span><span class="s">&quot;w&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">L</span><span class="s">&quot;z&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

<span class="w">    </span><span class="k">end</span>

<span class="w">    </span><span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">savefig</span>
<span class="w">        </span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>
<span class="k">end</span>


<span class="k">function</span><span class="w"> </span><span class="n">plot_strike</span><span class="p">(;</span><span class="w"> </span><span class="n">savefig</span><span class="o">=</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span>
<span class="w">                       </span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
<span class="w">                       </span><span class="n">figname</span><span class="o">=</span><span class="s">&quot;figures/american_option_2.pdf&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_american_option_model</span><span class="p">()</span>
<span class="w">    </span><span class="p">(;</span><span class="w"> </span><span class="n">t_vals</span><span class="p">,</span><span class="w"> </span><span class="n">z_vals</span><span class="p">,</span><span class="w"> </span><span class="n">w_vals</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">φ</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">β</span><span class="p">,</span><span class="w"> </span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span>
<span class="w">    </span><span class="n">h_star</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compute_cvf</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

<span class="w">    </span><span class="c"># Built Markov chains for simulation </span>
<span class="w">    </span><span class="n">z_mc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MarkovChain</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">z_vals</span><span class="p">)</span>
<span class="w">    </span><span class="n">P_φ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">w_vals</span><span class="p">),</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">w_vals</span><span class="p">))</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">eachindex</span><span class="p">(</span><span class="n">w_vals</span><span class="p">)</span><span class="w">  </span><span class="c"># Build IID chain</span>
<span class="w">        </span><span class="n">P_φ</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="o">:</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">φ</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="n">w_mc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MarkovChain</span><span class="p">(</span><span class="n">P_φ</span><span class="p">,</span><span class="w"> </span><span class="n">w_vals</span><span class="p">)</span>


<span class="w">    </span><span class="n">y_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">minimum</span><span class="p">(</span><span class="n">z_vals</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">minimum</span><span class="p">(</span><span class="n">w_vals</span><span class="p">)</span>
<span class="w">    </span><span class="n">y_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maximum</span><span class="p">(</span><span class="n">z_vals</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">maximum</span><span class="p">(</span><span class="n">w_vals</span><span class="p">)</span>
<span class="w">    </span><span class="n">fig</span><span class="p">,</span><span class="w"> </span><span class="n">axes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">))</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">ax</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">axes</span>

<span class="w">        </span><span class="c"># Generate price series</span>
<span class="w">        </span><span class="n">z_draws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">simulate_indices</span><span class="p">(</span><span class="n">z_mc</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">init</span><span class="o">=</span><span class="kt">Int</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">z_vals</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">10</span><span class="p">))</span>
<span class="w">        </span><span class="n">w_draws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">simulate_indices</span><span class="p">(</span><span class="n">w_mc</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">)</span>
<span class="w">        </span><span class="n">s_vals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z_vals</span><span class="p">[</span><span class="n">z_draws</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">w_vals</span><span class="p">[</span><span class="n">w_draws</span><span class="p">]</span>

<span class="w">        </span><span class="c"># Find the exercise date, if any.</span>
<span class="w">        </span><span class="n">exercise_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">T</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">e</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">w_draws</span><span class="p">[</span><span class="n">t</span><span class="p">],</span><span class="w"> </span><span class="n">z_draws</span><span class="p">[</span><span class="n">t</span><span class="p">])</span><span class="w"> </span><span class="o">≥</span><span class="w"> </span><span class="n">h_star</span><span class="p">[</span><span class="n">w_draws</span><span class="p">[</span><span class="n">t</span><span class="p">],</span><span class="w"> </span><span class="n">z_draws</span><span class="p">[</span><span class="n">t</span><span class="p">]]</span>
<span class="w">                </span><span class="n">exercise_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span>
<span class="w">            </span><span class="k">end</span>
<span class="w">        </span><span class="k">end</span>

<span class="w">        </span><span class="nd">@assert</span><span class="w"> </span><span class="n">exercise_date</span><span class="w"> </span><span class="o">≤</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="s">&quot;Option not exercised.&quot;</span>

<span class="w">        </span><span class="c"># Plot</span>
<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span><span class="w"> </span><span class="n">y_max</span><span class="p">)</span>
<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">)</span>
<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">ones</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">ones</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y_max</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">s_vals</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="sa">L</span><span class="s">&quot;S_t&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">exercise_date</span><span class="p">,),</span><span class="w"> </span><span class="p">(</span><span class="n">s_vals</span><span class="p">[</span><span class="n">exercise_date</span><span class="p">]),</span><span class="w"> </span><span class="s">&quot;ko&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">((</span><span class="n">exercise_date</span><span class="p">,),</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">s_vals</span><span class="p">[</span><span class="n">exercise_date</span><span class="p">]),</span><span class="w"> </span><span class="n">ls</span><span class="o">=</span><span class="s">&quot;--&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colors</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">&quot;upper left&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;in the money&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="w"> </span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mf">7.2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;out of the money&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="w"> </span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">exercise_date</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="c">#s_vals[exercise_date]+0.8, </span>
<span class="w">                </span><span class="s">&quot;exercise date&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">))</span>
<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">((</span><span class="n">y_min</span><span class="p">,</span><span class="w"> </span><span class="n">y_max</span><span class="p">))</span>
<span class="w">    </span><span class="k">end</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">savefig</span>
<span class="w">        </span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>plot_strike (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">plot_contours</span><span class="p">(</span><span class="n">savefig</span><span class="o">=</span><span class="nb">true</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 25 with error 0.006681671219211427.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 50 with error 0.0039970038843408495.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 75 with error 0.002922808660469428.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 100 with error 0.0019603799011774503.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 125 with error 0.0012415595933039647.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 150 with error 0.00077388789719951.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 175 with error 0.000481112768765779.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 200 with error 0.0.
Terminated successfully in 201 iterations.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../_images/c611132de947c93ee7d191ab16ed3dfeddcd1bb0f3c82884ef00c43ec352515d.png" src="../_images/c611132de947c93ee7d191ab16ed3dfeddcd1bb0f3c82884ef00c43ec352515d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">plot_strike</span><span class="p">(</span><span class="n">savefig</span><span class="o">=</span><span class="nb">true</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 25 with error 0.006681671219211427.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 50 with error 0.0039970038843408495.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 75 with error 0.002922808660469428.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 100 with error 0.0019603799011774503.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 125 with error 0.0012415595933039647.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 150 with error 0.00077388789719951.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 175 with error 0.000481112768765779.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completed iteration 200 with error 0.0.
Terminated successfully in 201 iterations.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../_images/28264ce076b44fdf7caf848a8c43fef086155b2f4ada1f7caa2dc3e17f59b1e9.png" src="../_images/28264ce076b44fdf7caf848a8c43fef086155b2f4ada1f7caa2dc3e17f59b1e9.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "julia-1.9"
        },
        kernelOptions: {
            name: "julia-1.9",
            path: "./jl"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'julia-1.9'</script>

                    </div>
                    
                </main> <!-- .page__content -->
                


                <footer class="qe-page__footer">

                    <p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png"></a></p>

                    <p>Creative Commons License &ndash; This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International.</p>

                </footer> <!-- .page__footer -->

            </div> <!-- .page -->

            

            
            <div class="qe-sidebar bd-sidebar inactive" id="site-navigation">

                <div class="qe-sidebar__header">


                    Contents

                </div>

                <nav class="qe-sidebar__nav" id="qe-sidebar-nav" aria-label="Main navigation">
                    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Julia Codebooks
 </span>
</p>
<ul class="current nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="introductions.html">
   Chapter 1: Introductions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="operators_fixed_points.html">
   Chapter 2: Operators and Fixed Points
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="markov_dynamics.html">
   Chapter 3: Markov Dynamics
  </a>
 </li>
 <li class="toctree-l1 current active active">
  <a class="current reference internal" href="#">
   Chapter 4: Optimal Stopping
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="markov_decision_processes.html">
   Chapter 5: Markov Decision Processes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stochastic_discounting.html">
   Chapter 6: Stochastic Discounting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="nonlinear_valuation.html">
   Chapter 7: Nonlinear Valuation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="recursive_decision_processes.html">
   Chapter 8: Recursive Decision Processes
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Python Codebooks
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../py/introductions.html">
   Chapter 1: Introductions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../py/operators_fixed_points.html">
   Chapter 2: Operators and Fixed Points
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../py/markov_dynamics.html">
   Chapter 3: Markov Dynamics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../py/optimal_stopping.html">
   Chapter 4: Optimal Stopping
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../py/markov_decision_processes.html">
   Chapter 5: Markov Decision Processes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../py/stochastic_discounting.html">
   Chapter 6: Stochastic Discounting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../py/nonlinear_valuation.html">
   Chapter 7: Nonlinear Valuation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../py/recursive_decision_processes.html">
   Chapter 8: Recursive Decision Processes
  </a>
 </li>
</ul>

                </nav>

                <div class="qe-sidebar__footer">

                </div>

            </div> <!-- .sidebar -->
            
        </div> <!-- .main -->

        <div class="qe-toolbar">

            <div class="qe-toolbar__inner">

                <ul class="qe-toolbar__main">
                    <li data-tippy-content="Table of Contents" class="btn__sidebar"><i data-feather="menu"></i></li>
                    <li data-tippy-content="Home"><a href="../intro.html"><i data-feather="home"></i></a></li>
                    <li class="btn__qelogo"><a href="https://quantecon.org" title=""><span class="show-for-sr">QuantEcon</span></a></li>
                </ul>

                <ul class="qe-toolbar__links">
                    <li class="btn__search">
                        <form action="../search.html" method="get">
                            <input type="search" class="form-control" name="q" id="search-input" placeholder="Search..." aria-label="Search..." autocomplete="off" accesskey="k">
                            <i data-feather="search" id="search-icon"></i>
                        </form>
                    </li>
                    <li data-tippy-content="Fullscreen" class="btn__fullscreen"><i data-feather="maximize"></i></li>
                    <li data-tippy-content="Increase font size" class="btn__plus"><i data-feather="plus-circle"></i></li>
                    <li data-tippy-content="Decrease font size" class="btn__minus"><i data-feather="minus-circle"></i></li>
                    <li data-tippy-content="Change contrast" class="btn__contrast"><i data-feather="sunset"></i></li>
                        <li data-tippy-content="Download PDF" onClick="window.print()"><i data-feather="file"></i></li>
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/orectique/book-dp1/blob/main-test/code-book/jl/optimal_stopping.md" download><i data-feather="github"></i></a></li>
                </ul>

            </div>

        </div> <!-- .toolbar -->
        <div id="downloadPDFModal" style="display: none;">
            <ul class="pdf-options" style="display: block;">
                <li class="download-pdf-book" onClick="window.print()">
                    <p>Lecture (PDF)</p>
                </li>
                <li class="download-pdf-file">
                    <a href="" download><p>Book (PDF)</p></a>
                </li>
            </ul>
        </div>
        <div id="settingsModal" style="display: none;">
            <p class="modal-title"> Notebook Launcher </p>
            <div class="modal-desc">
            <p>
                Choose public or private cloud service for "Launch" button.
            </p>
            </div>
            <p class="modal-subtitle">Select a server</p>
            <ul class="modal-servers">
            <li class="active launcher-public">
                <span class="label">Public</span>
                <select id="launcher-public-input">
                
                </select>
                <i class="fas fa-check-circle"></i>
            </li>
            <li class="launcher-private">
                <span class="label">Private</span>
                <input type="text" id="launcher-private-input" data-repourl="" data-urlpath="" data-branch=>
                <i class="fas fa-check-circle"></i>
            </li>
            </ul>
            <p class="launch"><a href="" id="advancedLaunchButton" target="_blank">Launch Notebook</a></p>
            <script>
                // QuantEcon Notebook Launcher
                const launcherTypeElements = document.querySelectorAll('#settingsModal .modal-servers li');
                // Highlight the server type if previous selection exists
                if (typeof localStorage.launcherType !== 'undefined') {
                  for (var i = 0; i < launcherTypeElements.length; i++) {
                    launcherTypeElements[i].classList.remove('active');
                    if ( launcherTypeElements[i].classList.contains(localStorage.launcherType) ) {
                      launcherTypeElements[i].classList.add('active');
                    }
                  }
                }
                // Highlight server type on click and set local storage value
                for (var i = 0; i < launcherTypeElements.length; i++) {
                  launcherTypeElements[i].addEventListener('click', function() {
                    for (var j = 0; j < launcherTypeElements.length; j++) {
                      launcherTypeElements[j].classList.remove('active');
                    }
                    this.classList.add('active');
                    if ( this.classList.contains('launcher-private') ) {
                      localStorage.launcherType = 'launcher-private';
                    } else if ( this.classList.contains('launcher-public') ) {
                      localStorage.launcherType = 'launcher-public';
                    }
                    setLaunchServer();
                  })
                }
                const launcherPublic = document.getElementById('launcher-public-input');
                const launcherPrivate = document.getElementById('launcher-private-input');
                const pageName = "jl/optimal_stopping";
                const repoURL = "";
                const urlPath = "";
                const branch = ""
                const launchNotebookLink = document.getElementById('advancedLaunchButton');

                // Highlight public server option if previous selection exists
                if (typeof localStorage.launcherPublic !== 'undefined') {
                  launcherPublic.value = localStorage.launcherPublic;
                }
                // Update local storage upon public server selection
                launcherPublic.addEventListener('change', (event) => {
                  setLaunchServer();
                });
                // Populate private server input if previous entry exists
                if (typeof localStorage.launcherPrivate !== 'undefined') {
                  launcherPrivate.value = localStorage.launcherPrivate;
                }
                // Update local storage when a private server is entered
                launcherPrivate.addEventListener('input', (event) => {
                  setLaunchServer();
                });

                // Function to update the "Launch Notebook" link href
                function setLaunchServer() {
                  launchNotebookLink.removeAttribute("style")
                  if ( localStorage.launcherType == 'launcher-private' ) {
                    let repoPrefix = "/jupyter/hub/user-redirect/git-pull?repo=" + repoURL + "&branch=" + branch + "&urlpath=" + urlPath;
                    launcherPrivateValue = launcherPrivate.value
                    if (!launcherPrivateValue) {
                        launchNotebookLink.removeAttribute("href")
                        launchNotebookLink.style.background = "grey"
                        return
                    }
                    localStorage.launcherPrivate = launcherPrivateValue;
                    privateServer = localStorage.launcherPrivate.replace(/\/$/, "")
                    if (!privateServer.includes("http")) {
                        privateServer = "http://" + privateServer
                    }
                    launchNotebookLinkURL = privateServer + repoPrefix;
                  } else if ( localStorage.launcherType == 'launcher-public' ) {
                    launcherPublicValue = launcherPublic.options[launcherPublic.selectedIndex].value;
                    localStorage.launcherPublic = launcherPublicValue;
                    launchNotebookLinkURL = localStorage.launcherPublic;
                  }
                  if (launchNotebookLinkURL) launchNotebookLink.href = launchNotebookLinkURL;
                }
                // Check if user has previously selected a server
                if ( (typeof localStorage.launcherPrivate !== 'undefined') || (typeof localStorage.launcherPublic !== 'undefined') ) {
                  setLaunchServer();
                }
                </script>

        </div>

    </div> <!-- .wrapper-->
  </body>
</html>